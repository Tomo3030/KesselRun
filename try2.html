<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
    canvas {
        border:1px solid #d3d3d3;
        background-color: #f1f1f1;
    }
</style>
</head>
<body onload="startGame()">
    <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
    <script type="text/javascript" src="objects.js"></script>
    <script>

        let obstacles = [];
        let particles = [];
        let switcher;
        let explode = false;
        let particleAngle = 0;
        let score;
        let gameOn = true;
        
        function startGame() {
            myGameArea.start();
            myGamePiece = new component(15,15,"red",(myGameArea.canvas.width/2), myGameArea.canvas.height * .95);
            finishBorder = new component(myGameArea.canvas.width, 70, "blue",0,0);
            //the finish line is what the gamePiece must actually crashWith() in order to win.
            finishline = new component(myGameArea.canvas.width,28,"transparent",0,0);
            score = new component("30px","Orbitron","white",15,30,"text");
        }


        function everyInterval(n){
            if((myGameArea.frameNo / n) % 1 == 0){return true;}
            return false;
        }

        function updateGameArea(){
            myGameArea.clear();
            finishBorder.update();
            finishline.update();
            myGamePiece.newPos();
            myGamePiece.updateTurn();
            myGamePiece.moveAngle = 0;
            myGameArea.frameNo += 1;
            if(gameOn){score.text = "SPEED: " + (Math.round(myGamePiece.speed * 1000,0));}
            score.update();

        //obstacles 
        if (myGameArea.frameNo == 1 || everyInterval(30)){
            end = myGameArea.canvas.height - myGameArea.canvas.height * .20;
            start = myGameArea.canvas.height - myGameArea.canvas.height * .90;
            x = myGameArea.canvas.width;
            y = Math.floor((Math.random() * end) + start);
            
            if(switcher){
                obstacles.push(new component(50,10,"green",x,y));
                switcher = false;
            } else {
                obstacles.push(new component(50,10,"pink", -20,y));
                switcher = true; 
            }
        }  
        //make them appear and move
        for (let i = 0; i < obstacles.length; i++) {
            if(obstacles[i].color == "pink"){
                obstacles[i].x += 1;
                obstacles[i].update();
            } else{
                obstacles[i].x += -1;
                obstacles[i].update();

            }
           // delete obstacles that go offscreeen so our array doesn't get crazy long
           if(obstacles[i].offscreen()){
             obstacles.splice(i,1);
         } 
     }
     for(let i = 0; i < obstacles.length; i++) {
        if((gameOn) && myGamePiece.crashWith(obstacles[i])){
            //myGameArea.clear();
            myGamePiece.width = 0;
            myGamePiece.height = 0;
            myGamePiece.speed = 0;
            //score.text = "SPEED: " + (Math.round(myGamePiece.speed * 1000,0));
            gameOn = !gameOn;
            if(!explode){
                myGamePiece.makeParticles(myGamePiece.x,myGamePiece.y);
            }
        }


        if(explode){
            for (var j = 0; j < particles.length; j++) {
                particles[j].newPos();
                particles[j].updateTurn();
                if(particles[j].offscreen()){
                    particles.splice(j,1);
                }
            }
        }

        function calculateMultiplyer(multiplyer){
            return((multiplyer * 2)/(myGameArea.canvas.width/2)).toFixed(2);
        }

        //win the game
        if((gameOn) && myGamePiece.crashWith(finishline)){
            let multiplyer;
            if(myGamePiece.x > 270){
                multiplyer = (myGamePiece.x - 540) * -1;
            } else {
                multiplyer = myGamePiece.x;
            }
            console.log((calculateMultiplyer(multiplyer) * myGamePiece.speed*1000).toFixed(0));
            

            score.text = "SPEED: " + (myGamePiece.speed * 1000).toFixed(0);
            myGamePiece.speed = 0;
            gameOn = !gameOn;
        }
        
        if(gameOn){
         myGamePiece.speed += .0001;
        // game controls
        if (myGameArea.keys && myGameArea.keys[37]) {myGamePiece.moveAngle = -myGamePiece.speed; }
        if (myGameArea.keys && myGameArea.keys[39]) {myGamePiece.moveAngle = myGamePiece.speed; }
        if (myGameArea.keys && myGameArea.keys[38]) {myGamePiece.speed = 2; }
        if (myGameArea.keys && myGameArea.keys[40]) {myGamePiece.speed += -.01; }
    }
}


        // no out of bounds
        if(myGamePiece.x < (myGameArea.canvas.width - myGameArea.canvas.width)){
            myGamePiece.x = (myGameArea.canvas.width - myGameArea.canvas.width);
        }
        if(myGamePiece.x > (myGameArea.canvas.width - myGamePiece.width)){
            myGamePiece.x = (myGameArea.canvas.width - myGamePiece.width);
        }
        if(myGamePiece.y > (myGameArea.canvas.height- myGamePiece.height)){
            myGamePiece.y = (myGameArea.canvas.height- myGamePiece.height);
        }

        if(myGamePiece.y < finishline.height){
            myGamePiece.y = (finishline.height);
        }
    }
    //title 
    // monofett
    // faster one

    // orbitron 
    // wallpoet        

</script>

</body>
</html>
